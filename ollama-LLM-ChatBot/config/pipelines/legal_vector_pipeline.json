{
  "pipeline_name": "legal_vector_pipeline",
  "description": "법률 문서 벡터 검색 파이프라인 - 정확도 중심의 법률 조문 검색",
  "version": "1.0.0",
  "enabled": true,
  
  "models": {
    "embedding_model": {
      "name": "jhgan/ko-sroberta-multitask",
      "description": "한국어 특화 임베딩 모델",
      "cache_folder": "./models",
      "max_length": 512,
      "normalize_embeddings": true
    },
    "cross_encoder": {
      "name": "BAAI/bge-reranker-v2-m3",
      "fallback_model": "jhgan/ko-sroberta-multitask",
      "description": "재순위화용 크로스엔코더 모델",
      "max_length": 512,
      "batch_size": 16
    }
  },
  
  "chunking": {
    "max_chunk_size": 1000,
    "min_chunk_size": 100,
    "overlap_size": 150,
    "article_based": true,
    "preserve_structure": true,
    "keyword_extraction": {
      "enabled": true,
      "max_keywords": 15,
      "min_keyword_length": 2,
      "include_article_refs": true,
      "include_legal_concepts": true
    },
    "description": "법률 문서 청킹 설정 - 조문 기준"
  },
  
  "indexing": {
    "vector_store_path": "vector_store/legal",
    "hnsw_params": {
      "M": 48,
      "ef_construction": 200,
      "ef_search": 128,
      "description": "HNSW 인덱스 파라미터"
    },
    "multiview_weights": {
      "content": 0.6,
      "structure": 0.25,
      "keywords": 0.15,
      "description": "멀티뷰 임베딩 가중치"
    },
    "lazy_loading": {
      "enabled": true,
      "description": "임베딩 모델 지연 로딩"
    },
    "bm25_params": {
      "max_features": 10000,
      "ngram_range": [1, 3],
      "analyzer": "char",
      "min_df": 2,
      "max_df": 0.95,
      "description": "BM25 키워드 검색 파라미터"
    }
  },
  
  "search": {
    "hybrid_search": {
      "dense_k": 200,
      "bm25_k": 200,
      "rrf_k": 200,
      "rrf_constant": 60,
      "vector_weight": 0.7,
      "bm25_weight": 0.3,
      "description": "하이브리드 검색 설정"
    },
    "mmr": {
      "mmr_k": 80,
      "mmr_lambda": 0.7,
      "description": "MMR 다양화 파라미터 (높을수록 관련성 우선)"
    },
    "multiview_enabled": true
  },
  
  "reranking": {
    "enabled": true,
    "max_candidates": 80,
    "batch_size": 16,
    "calibration": {
      "enabled": true,
      "temperature": 1.0,
      "bias": 0.0,
      "description": "점수 캘리브레이션 설정"
    },
    "thresholds": {
      "accuracy_mode": 0.7,
      "exploration_mode": 0.4,
      "inference_mode": 0.5,
      "description": "모드별 신뢰도 임계값"
    }
  },
  
  "inference": {
    "enabled": true,
    "max_candidates": 5,
    "min_confidence": 0.6,
    "verification_threshold": 0.7,
    "weights": {
      "domain_weight": 0.3,
      "keyword_weight": 0.2,
      "semantic_weight": 0.5,
      "description": "법률 유추 가중치"
    },
    "domain_classification": {
      "enabled": true,
      "domains": [
        "labor", "privacy", "environment", "commerce", 
        "criminal", "civil", "administrative", 
        "intellectual_property", "tax", "construction"
      ]
    }
  },
  
  "routing": {
    "default_mode": "accuracy",
    "modes": {
      "accuracy": {
        "threshold": 0.7,
        "max_results": 3,
        "conservative_response": true,
        "enable_reranking": true,
        "description": "정확도 우선 모드 - 보수적 응답"
      },
      "exploration": {
        "threshold": 0.4,
        "max_results": 10,
        "conservative_response": false,
        "enable_reranking": true,
        "description": "탐색 모드 - 폭넓은 검색"
      },
      "inference": {
        "threshold": 0.5,
        "max_results": 5,
        "enable_law_inference": true,
        "enable_reranking": true,
        "description": "법률 유추 모드"
      }
    }
  },
  
  "quality_control": {
    "conservative_response": true,
    "require_source_citation": true,
    "min_confidence_for_answer": 0.6,
    "max_response_time_seconds": 30,
    "fallback_to_general_search": true,
    "description": "품질 관리 설정"
  },
  
  "logging": {
    "enabled": true,
    "log_files": {
      "queries": "logs/legal_queries.log",
      "evaluation": "logs/legal_eval.log",
      "errors": "logs/legal_errors.log"
    },
    "log_level": "INFO",
    "include_metadata": true,
    "include_scores": true,
    "include_reasoning": true
  },
  
  "performance": {
    "cache_enabled": true,
    "cache_ttl_seconds": 3600,
    "max_concurrent_requests": 10,
    "timeout_seconds": 30,
    "memory_limit_gb": 4.0,
    "model_sharing": {
      "enabled": true,
      "description": "모델 인스턴스 공유로 메모리 절약"
    }
  },
  
  "evaluation": {
    "enabled": false,
    "metrics": [
      "ndcg@10", "recall@50", "precision@5", 
      "answerable@threshold", "calibration_auce"
    ],
    "validation_dataset_path": "data/legal_validation.jsonl",
    "auto_threshold_tuning": false
  },
  
  "data_sources": {
    "supported_formats": ["pdf", "json", "txt"],
    "pdf_processing": {
      "extract_structure": true,
      "preserve_hierarchy": true,
      "extract_metadata": true
    },
    "json_schema": {
      "required_fields": ["law_id", "law_title", "content"],
      "optional_fields": [
        "article_no", "clause_no", "effective_date", 
        "aliases", "section_hierarchy"
      ]
    }
  },
  
  "integration": {
    "query_router_integration": true,
    "main_pipeline_fallback": true,
    "api_endpoints": {
      "search": "/api/legal/search",
      "inference": "/api/legal/infer",
      "stats": "/api/legal/stats"
    }
  },
  
  "metadata": {
    "created_date": "2024-01-01",
    "last_modified": "2024-01-01",
    "author": "Legal AI System",
    "tags": ["legal", "vector-search", "korean", "accuracy"],
    "dependencies": [
      "sentence-transformers>=2.0.0",
      "transformers>=4.0.0",
      "faiss-cpu>=1.7.0",
      "chromadb>=0.4.0",
      "scikit-learn>=1.0.0"
    ]
  }
}
