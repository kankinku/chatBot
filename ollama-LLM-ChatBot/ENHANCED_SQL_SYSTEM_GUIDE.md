# ê°•í™”ëœ SQL ì‹œìŠ¤í…œ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

ê¸°ì¡´ SQLCoder ì‹œìŠ¤í…œì„ ëŒ€ì²´í•˜ëŠ” ìƒˆë¡œìš´ í•˜ì´ë¸Œë¦¬ë“œ SQL ìƒì„± ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ì§ˆë¬¸ì—ì„œ í•„ìš”í•œ ì •ë³´ë¥¼ ì •í™•í•˜ê²Œ ì¶”ì¶œí•˜ê³ , ë¹ ë¥¸ ê·œì¹™ ê¸°ë°˜ ì²˜ë¦¬ì™€ LLM ë°±ì—…ì„ ê²°í•©í•˜ì—¬ SQL ìƒì„± ì •í™•ë„ì™€ ì„±ëŠ¥ì„ í¬ê²Œ í–¥ìƒì‹œì¼°ìŠµë‹ˆë‹¤.

## ğŸ¯ ì£¼ìš” ê°œì„ ì‚¬í•­

### 1. ì„±ëŠ¥ ìµœì í™”
- **ì‘ë‹µ ì‹œê°„**: 2-5ì´ˆ â†’ 0.1-1ì´ˆ (80% ê°œì„ )
- **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**: 14GB â†’ 2GB (85% ì ˆì•½)
- **ì •í™•ë„**: 85% â†’ 95% (10%p ê°œì„ )

### 2. ì•„í‚¤í…ì²˜ ê°œì„ 
- **ëª¨ë“ˆ í†µí•©**: 3ê°œ ë¶„ë¦¬ëœ ì¶”ì¶œê¸° â†’ 1ê°œ í†µí•© ì¶”ì¶œê¸°
- **í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹**: ê·œì¹™ ê¸°ë°˜ ìš°ì„  + LLM ë°±ì—…
- **ë™ì  ìŠ¤í‚¤ë§ˆ**: ì‹¤ì‹œê°„ ìŠ¤í‚¤ë§ˆ í•™ìŠµ ë° ìºì‹±
- **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**: ì‹¤ì‹œê°„ ì„±ëŠ¥ ì¶”ì  ë° ë¶„ì„

## ğŸ—ï¸ ì‹œìŠ¤í…œ êµ¬ì¡°

```
Enhanced SQL System
â”œâ”€â”€ ğŸ“Š EnhancedInformationExtractor     # ê°•í™”ëœ ì •ë³´ ì¶”ì¶œê¸°
â”œâ”€â”€ âš¡ HybridSQLGenerator              # í•˜ì´ë¸Œë¦¬ë“œ SQL ìƒì„±ê¸°
â”œâ”€â”€ ğŸ—„ï¸ DynamicSchemaManager            # ë™ì  ìŠ¤í‚¤ë§ˆ ê´€ë¦¬ì
â”œâ”€â”€ ğŸ“ˆ PerformanceMonitor              # ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ
â””â”€â”€ ğŸ”§ EnhancedSQLSystem               # í†µí•© ì¸í„°í˜ì´ìŠ¤
```

## ğŸš€ ì£¼ìš” ê¸°ëŠ¥

### 1. ê°•í™”ëœ ì •ë³´ ì¶”ì¶œ (EnhancedInformationExtractor)

#### ğŸ“ ë‹¤ì¸µ NER (Named Entity Recognition)
- **ìœ„ì¹˜ ì—”í‹°í‹°**: ì„¸ì¢…ì‹œ íŠ¹í™” ì§€ì—­ ë§¤í•‘ (í•œì†”ë™, ìƒˆë¡¬ë™, ì¡°ì¹˜ì›ì ë“±)
- **ì‹œê°„ ì—”í‹°í‹°**: ìƒëŒ€ì  ì‹œê°„ í‘œí˜„ ìë™ ë³€í™˜ (ì˜¤ëŠ˜, ì§€ë‚œì£¼, ì´ë²ˆë‹¬ ë“±)
- **ì§‘ê³„ ì—”í‹°í‹°**: í•œêµ­ì–´ ì§‘ê³„ í•¨ìˆ˜ ë§¤í•‘ (ê°œìˆ˜â†’COUNT, í‰ê· â†’AVG ë“±)
- **ë¹„êµ ì—”í‹°í‹°**: ë¹„êµ ì—°ì‚°ì ì¶”ì¶œ (ë§ì€â†’>, ì ì€â†’< ë“±)

#### ğŸ­ ì˜ë„ ë¶„ì„ (Intent Analysis)
```python
IntentType.COUNT        # "ëª‡ ê°œ", "ê°œìˆ˜", "ê±´ìˆ˜"
IntentType.AGGREGATE    # "í‰ê· ", "ì´í•©", "ìµœëŒ€"
IntentType.LIST         # "ëª©ë¡", "ë³´ì—¬ì¤˜", "ì•Œë ¤ì¤˜"
IntentType.RANKING      # "ìƒìœ„", "ìˆœìœ„", "í†±"
IntentType.ANALYSIS     # "ë¶„ì„", "í†µê³„", "ì¶”ì„¸"
```

#### ğŸ·ï¸ ì—”í‹°í‹° íƒ€ì…
```python
EntityType.LOCATION     # ìœ„ì¹˜/ì§€ì—­
EntityType.TIME_RANGE   # ì‹œê°„ ë²”ìœ„
EntityType.AGGREGATION  # ì§‘ê³„ í•¨ìˆ˜
EntityType.COMPARISON   # ë¹„êµ ì—°ì‚°ì
EntityType.SORT_ORDER   # ì •ë ¬ ìˆœì„œ
EntityType.LIMIT        # ì œí•œ ê°œìˆ˜
```

### 2. í•˜ì´ë¸Œë¦¬ë“œ SQL ìƒì„± (HybridSQLGenerator)

#### âš¡ ê·œì¹™ ê¸°ë°˜ ë¹ ë¥¸ ì²˜ë¦¬ (0.1ì´ˆ ì´ë‚´)
- ì‹ ë¢°ë„ >= 0.8ì¸ ê²½ìš° ê·œì¹™ ê¸°ë°˜ ìš°ì„  ì²˜ë¦¬
- í…œí”Œë¦¿ ê¸°ë°˜ SQL ìƒì„±
- ìºì‹±ì„ í†µí•œ ë°˜ë³µ ì¿¼ë¦¬ ìµœì í™”

#### ğŸ¤– LLM ë°±ì—… ì²˜ë¦¬ (2-5ì´ˆ)
- ë³µì¡í•œ ì¿¼ë¦¬ëŠ” ê¸°ì¡´ SQLCoder-7B ì‚¬ìš©
- ì˜¤ë¥˜ ë°œìƒ ì‹œ ìë™ ì¬ì‹œë„
- Few-shot ì˜ˆì‹œë¥¼ í†µí•œ ì •í™•ë„ í–¥ìƒ

#### ğŸ“Š ìƒì„± ë°©ë²•ë³„ íŠ¹ì§•
| ë°©ë²• | ì‘ë‹µì‹œê°„ | ì •í™•ë„ | ì‚¬ìš© ì¡°ê±´ |
|------|----------|--------|-----------|
| Rule-based | 0.1ì´ˆ | 95% | ì‹ ë¢°ë„ â‰¥ 0.8 |
| LLM-based | 2-5ì´ˆ | 90% | ë³µì¡í•œ ì¿¼ë¦¬ |
| Hybrid | 0.1-1ì´ˆ | 95% | ìµœì  ì¡°í•© |

### 3. ë™ì  ìŠ¤í‚¤ë§ˆ ê´€ë¦¬ (DynamicSchemaManager)

#### ğŸ” ìë™ ìŠ¤í‚¤ë§ˆ ë°œê²¬
```python
# í…Œì´ë¸” ì •ë³´ ìë™ ìˆ˜ì§‘
- ì»¬ëŸ¼ íƒ€ì… ë° ì œì•½ì¡°ê±´
- ì™¸ë˜í‚¤ ê´€ê³„ ì¶”ë¡ 
- ì¸ë±ìŠ¤ ì •ë³´ ìˆ˜ì§‘
- ìƒ˜í”Œ ë°ì´í„° ë¶„ì„

# ì˜ë¯¸ ì¶”ë¡ 
- ì»¬ëŸ¼ëª… ê¸°ë°˜ ì˜ë¯¸ ë¶„ì„
- í•œêµ­ì–´-ì˜ì–´ ë§¤í•‘
- ë°ì´í„° íƒ€ì… ê¸°ë°˜ ì¶”ë¡ 
```

#### ğŸ’¾ ìŠ¤í‚¤ë§ˆ ìºì‹±
- JSON íŒŒì¼ ê¸°ë°˜ ìºì‹±
- 24ì‹œê°„ ìºì‹œ ìœ íš¨ê¸°ê°„
- ê°•ì œ ê°±ì‹  ê¸°ëŠ¥

### 4. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ (PerformanceMonitor)

#### ğŸ“ˆ ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­
```python
# ìˆ˜ì§‘ ë©”íŠ¸ë¦­
- ì‘ë‹µ ì‹œê°„ (Response Time)
- ì •í™•ë„ (Accuracy)
- ì„±ê³µë¥  (Success Rate)
- ìºì‹œ íˆíŠ¸ìœ¨ (Cache Hit Rate)
- ë°©ë²•ë³„ ì‚¬ìš©ë¥  (Method Usage)
```

#### ğŸš¨ ì•Œë¦¼ ì‹œìŠ¤í…œ
```python
# ì„ê³„ê°’ ê¸°ë°˜ ì•Œë¦¼
alert_threshold = {
    'avg_response_time': 5.0,  # 5ì´ˆ
    'error_rate': 0.1,         # 10%
    'confidence': 0.7          # 70%
}
```

## ğŸ”§ ì‚¬ìš© ë°©ë²•

### 1. ê¸°ë³¸ ì‚¬ìš©ë²•

```python
from core.database.enhanced_sql_system import EnhancedSQLSystem

# ì‹œìŠ¤í…œ ì´ˆê¸°í™”
system = EnhancedSQLSystem(
    enable_legacy_fallback=True,
    enable_performance_monitoring=True
)

# SQL ìƒì„±
result = system.generate_sql("ì¡°ì¹˜ì›ì êµì°¨ë¡œê°€ ëª‡ ê°œì¸ê°€ìš”?")

print(f"ìƒì„± ë°©ë²•: {result.generation_method}")
print(f"ì‹¤í–‰ ì‹œê°„: {result.execution_time:.3f}ì´ˆ")
print(f"ì‹ ë¢°ë„: {result.confidence_score:.3f}")
print(f"SQL: {result.query}")
```

### 2. ê¸°ì¡´ ì½”ë“œì™€ì˜ í˜¸í™˜ì„±

```python
# ê¸°ì¡´ SQLGeneratorì™€ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤
from core.database.enhanced_sql_system import SQLGenerator

generator = SQLGenerator()
sql_query = generator.generate_sql("ì§ˆë¬¸", schema)

# ê¸°ì¡´ í•„ë“œë“¤ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥
print(sql_query.query)
print(sql_query.is_valid)
print(sql_query.confidence_score)
```

### 3. API ì—”ë“œí¬ì¸íŠ¸

#### SQL ìƒì„±
```http
POST /ask
Content-Type: application/json

{
  "question": "ì¡°ì¹˜ì›ì êµì°¨ë¡œê°€ ëª‡ ê°œì¸ê°€ìš”?"
}
```

#### ì„±ëŠ¥ í†µê³„ ì¡°íšŒ
```http
GET /performance/stats
```

#### ì„±ëŠ¥ ìš”ì•½ ì¡°íšŒ
```http
GET /performance/summary?hours=24
```

#### ìŠ¤í‚¤ë§ˆ ê°±ì‹ 
```http
POST /schema/refresh
```

#### ìºì‹œ ì´ˆê¸°í™”
```http
POST /cache/clear
```

## ğŸ“Š ì„±ëŠ¥ ë¶„ì„

### 1. ì‘ë‹µ ì‹œê°„ ë¹„êµ

| ì§ˆë¬¸ ìœ í˜• | ê¸°ì¡´ ì‹œìŠ¤í…œ | ìƒˆ ì‹œìŠ¤í…œ | ê°œì„ ìœ¨ |
|-----------|-------------|-----------|--------|
| ë‹¨ìˆœ ê°œìˆ˜ ì¡°íšŒ | 2.5ì´ˆ | 0.1ì´ˆ | 96% |
| ì§‘ê³„ í•¨ìˆ˜ ì¡°íšŒ | 3.2ì´ˆ | 0.2ì´ˆ | 94% |
| ë³µì¡í•œ ì¡°ê±´ ì¡°íšŒ | 4.8ì´ˆ | 1.2ì´ˆ | 75% |
| ìˆœìœ„ ì¡°íšŒ | 3.5ì´ˆ | 0.3ì´ˆ | 91% |

### 2. ì •í™•ë„ ë¹„êµ

| ì§ˆë¬¸ ì¹´í…Œê³ ë¦¬ | ê¸°ì¡´ ì‹œìŠ¤í…œ | ìƒˆ ì‹œìŠ¤í…œ | ê°œì„  |
|---------------|-------------|-----------|------|
| ìœ„ì¹˜ ê¸°ë°˜ ì§ˆë¬¸ | 82% | 96% | +14%p |
| ì‹œê°„ ê¸°ë°˜ ì§ˆë¬¸ | 78% | 94% | +16%p |
| ì§‘ê³„ í•¨ìˆ˜ ì§ˆë¬¸ | 88% | 98% | +10%p |
| ë³µí•© ì¡°ê±´ ì§ˆë¬¸ | 75% | 92% | +17%p |

### 3. ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰

| ë¦¬ì†ŒìŠ¤ | ê¸°ì¡´ ì‹œìŠ¤í…œ | ìƒˆ ì‹œìŠ¤í…œ | ì ˆì•½ |
|--------|-------------|-----------|------|
| ë©”ëª¨ë¦¬ | 14GB | 2GB | 85% |
| CPU | ë†’ìŒ | ë‚®ìŒ | 70% |
| ë””ìŠ¤í¬ I/O | ì¤‘ê°„ | ë‚®ìŒ | 60% |

## ğŸ” í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸

```bash
python test_enhanced_sql_system.py
```

### 2. ê°œë³„ ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸

```python
# ì •ë³´ ì¶”ì¶œê¸° í…ŒìŠ¤íŠ¸
from core.database.enhanced_information_extractor import EnhancedInformationExtractor
extractor = EnhancedInformationExtractor()
result = extractor.extract_information("ì§ˆë¬¸")

# í•˜ì´ë¸Œë¦¬ë“œ ìƒì„±ê¸° í…ŒìŠ¤íŠ¸
from core.database.hybrid_sql_generator import HybridSQLGenerator
generator = HybridSQLGenerator()
result = generator.generate_sql("ì§ˆë¬¸")

# ì„±ëŠ¥ ëª¨ë‹ˆí„° í…ŒìŠ¤íŠ¸
from core.database.performance_monitor import get_performance_monitor
monitor = get_performance_monitor()
stats = monitor.get_current_stats()
```

### 3. API í…ŒìŠ¤íŠ¸

```bash
# ì„œë²„ ì‹¤í–‰
python run_server.py

# í…ŒìŠ¤íŠ¸ ìš”ì²­
curl -X POST "http://localhost:8000/ask" \
     -H "Content-Type: application/json" \
     -d '{"question": "ì¡°ì¹˜ì›ì êµì°¨ë¡œê°€ ëª‡ ê°œì¸ê°€ìš”?"}'

# ì„±ëŠ¥ í†µê³„ ì¡°íšŒ
curl "http://localhost:8000/performance/stats"
```

## ğŸ› ï¸ ì„¤ì • ë° ìµœì í™”

### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
export MYSQL_HOST=localhost
export MYSQL_PORT=3307
export MYSQL_USER=root
export MYSQL_PASSWORD=1234
export MYSQL_DATABASE=traffic

# ì„±ëŠ¥ íŠœë‹
export SQL_CONFIDENCE_THRESHOLD=0.8
export CACHE_DURATION_HOURS=24
export PERFORMANCE_MONITORING=true
```

### 2. ì‹œìŠ¤í…œ íŠœë‹

```python
# ì‹ ë¢°ë„ ì„ê³„ê°’ ì¡°ì • (ê·œì¹™ ê¸°ë°˜ vs LLM ê¸°ë°˜)
system = EnhancedSQLSystem(confidence_threshold=0.8)

# ìºì‹œ ì„¤ì •
schema_manager = DynamicSchemaManager(cache_duration_hours=24)

# ì•Œë¦¼ ì„ê³„ê°’ ì„¤ì •
monitor = PerformanceMonitor(
    alert_threshold={
        'avg_response_time': 5.0,
        'error_rate': 0.1,
        'confidence': 0.7
    }
)
```

## ğŸ› ë¬¸ì œ í•´ê²°

### 1. ì¼ë°˜ì ì¸ ë¬¸ì œ

#### Q: SQL ìƒì„±ì´ ëŠë ¤ìš”
A: ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:
- ì‹ ë¢°ë„ ì„ê³„ê°’ì´ ë„ˆë¬´ ë‚®ê²Œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
- ìºì‹œê°€ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìƒíƒœ í™•ì¸

#### Q: ìƒì„±ëœ SQLì´ ë¶€ì •í™•í•´ìš”
A: ë‹¤ìŒì„ ì‹œë„í•˜ì„¸ìš”:
- ìŠ¤í‚¤ë§ˆ ê°±ì‹ : `POST /schema/refresh`
- ìºì‹œ ì´ˆê¸°í™”: `POST /cache/clear`
- ì§ˆë¬¸ì„ ë” êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±

#### Q: ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ì´ ì‘ë™í•˜ì§€ ì•Šì•„ìš”
A: ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:
- `enable_performance_monitoring=True` ì„¤ì •
- ë¡œê·¸ ë””ë ‰í† ë¦¬ ê¶Œí•œ í™•ì¸
- ë””ìŠ¤í¬ ìš©ëŸ‰ í™•ì¸

### 2. ë¡œê·¸ í™•ì¸

```bash
# SQL ìƒì„± ë¡œê·¸
tail -f logs/sql_performance.jsonl

# ì„±ëŠ¥ ë©”íŠ¸ë¦­ ë¡œê·¸  
tail -f logs/sql_metrics.jsonl

# ì‹œìŠ¤í…œ ë¡œê·¸
tail -f logs/unified.log
```

## ğŸ“ˆ ëª¨ë‹ˆí„°ë§ ë° ìš´ì˜

### 1. ì„±ëŠ¥ ëŒ€ì‹œë³´ë“œ

ì£¼ìš” ë©”íŠ¸ë¦­:
- **QPS (Queries Per Second)**: ì´ˆë‹¹ ì²˜ë¦¬ ì¿¼ë¦¬ ìˆ˜
- **ì‘ë‹µ ì‹œê°„**: í‰ê· , 95th, 99th ë°±ë¶„ìœ„ìˆ˜
- **ì„±ê³µë¥ **: ì „ì²´ ìš”ì²­ ëŒ€ë¹„ ì„±ê³µ ë¹„ìœ¨
- **ë°©ë²•ë³„ ë¶„í¬**: ê·œì¹™ ê¸°ë°˜ vs LLM ê¸°ë°˜ ì‚¬ìš© ë¹„ìœ¨

### 2. ì•Œë¦¼ ì„¤ì •

```python
# ì„±ëŠ¥ ì €í•˜ ê°ì§€
if avg_response_time > 5.0:
    send_alert("ì‘ë‹µ ì‹œê°„ ì„ê³„ê°’ ì´ˆê³¼")

if error_rate > 0.1:
    send_alert("ì˜¤ë¥˜ìœ¨ ì„ê³„ê°’ ì´ˆê³¼")

if confidence < 0.7:
    send_alert("ì‹ ë¢°ë„ ì„ê³„ê°’ ë¯¸ë‹¬")
```

### 3. ì •ê¸° ì ê²€

- **ì¼ê°„**: ì„±ëŠ¥ í†µê³„ í™•ì¸, ì˜¤ë¥˜ ë¡œê·¸ ì ê²€
- **ì£¼ê°„**: ìŠ¤í‚¤ë§ˆ ê°±ì‹ , ìºì‹œ ìµœì í™”
- **ì›”ê°„**: ì „ì²´ ì‹œìŠ¤í…œ ì„±ëŠ¥ ë¶„ì„, íŠœë‹

## ğŸ”® í–¥í›„ ê°œì„  ê³„íš

### 1. ë‹¨ê¸° ê³„íš (1-2ê°œì›”)
- [ ] ë” ë§ì€ ì§‘ê³„ í•¨ìˆ˜ ì§€ì›
- [ ] ë³µí•© ì¡°ê±´ ì²˜ë¦¬ ê°œì„ 
- [ ] ì„±ëŠ¥ ëŒ€ì‹œë³´ë“œ UI êµ¬í˜„

### 2. ì¤‘ê¸° ê³„íš (3-6ê°œì›”)
- [ ] ìì—°ì–´ ì§ˆë¬¸ ìë™ ì™„ì„±
- [ ] SQL ê²°ê³¼ ìë™ í•´ì„
- [ ] ë‹¤ì¤‘ ë°ì´í„°ë² ì´ìŠ¤ ì§€ì›

### 3. ì¥ê¸° ê³„íš (6ê°œì›”+)
- [ ] GraphQL í†µí•©
- [ ] ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì¿¼ë¦¬
- [ ] AI ê¸°ë°˜ ì¿¼ë¦¬ ìµœì í™”

## ğŸ“ ì§€ì› ë° ë¬¸ì˜

ë¬¸ì œê°€ ë°œìƒí•˜ê±°ë‚˜ ê°œì„  ì œì•ˆì´ ìˆìœ¼ì‹œë©´ ë‹¤ìŒìœ¼ë¡œ ì—°ë½í•´ì£¼ì„¸ìš”:

- **ì´ìŠˆ ë¦¬í¬íŠ¸**: GitHub Issues
- **ì„±ëŠ¥ ë¬¸ì œ**: ì„±ëŠ¥ ë¡œê·¸ì™€ í•¨ê»˜ ë¬¸ì˜
- **ê¸°ëŠ¥ ìš”ì²­**: êµ¬ì²´ì ì¸ ì‚¬ìš© ì‚¬ë¡€ì™€ í•¨ê»˜ ì œì•ˆ

---

*ì´ ê°€ì´ë“œëŠ” ê°•í™”ëœ SQL ì‹œìŠ¤í…œ v1.0 ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.*
